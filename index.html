<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>OSHER HOLIDAYS – Devis Pessa'h 2026 – OASIS PARK 4*</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --line:#d7d7d7;
      --muted:#666;
    }
    body{
      font-family: Arial, Helvetica, sans-serif;
      background:#f4f6f8;
      margin:0;
      padding:18px;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .card{
      background:#fff;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      padding:18px;
    }
    h1{
      font-size:20px;
      margin:0 0 12px 0;
      text-align:center;
    }
    label{
      display:block;
      font-weight:700;
      margin-top:10px;
      font-size:13px;
    }
    input, select{
      width:100%;
      padding:9px;
      border:1px solid #dcdcdc;
      border-radius:8px;
      margin-top:6px;
      box-sizing:border-box;
    }
    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .btn{
      margin-top:16px;
      width:100%;
      padding:12px;
      border:0;
      border-radius:10px;
      background:#0b66ff;
      color:#fff;
      font-weight:800;
      cursor:pointer;
      font-size:15px;
    }
    .btn:hover{filter:brightness(.95);}
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    /* PAGE A4 PREVIEW SOUS LE FORMULAIRE */
    .page{
      background:#fff;
      margin:0 auto;
      box-shadow:0 6px 18px rgba(0,0,0,.12);
      padding:14mm;
      box-sizing:border-box;
      max-width:210mm;
    }

    .info-grid{
      margin-top:10px;
      width:65%;
      border-collapse:collapse;
      font-size:12px;
    }
    .info-grid td{
      border:1px solid var(--line);
      padding:6px 8px;
    }
    .info-grid td:first-child{
      background:#f3f3f3;
      font-weight:700;
      width:35%;
    }

    .table{
      margin-top:14px;
      width:100%;
      border-collapse:collapse;
      font-size:12px;
    }
    .table th,.table td{
      border:1px solid var(--line);
      padding:7px 8px;
      vertical-align:top;
    }
    .table th{
      background:#f3f3f3;
      font-weight:800;
      text-align:center;
    }
    .desc{font-weight:800;}
    .num{text-align:center; width:14%;}
    .money{text-align:right; width:18%; white-space:nowrap;}

    .footer{
      display:flex;
      justify-content:space-between;
      gap:16px;
      margin-top:14px;
      font-size:12px;
    }
    .totals{
      border-collapse:collapse;
      font-size:12px;
      min-width:220px;
    }
    .totals td{
      border:1px solid var(--line);
      padding:6px 8px;
    }
    .totals td:first-child{
      background:#f3f3f3;
      font-weight:800;
    }
    .totals td:last-child{
      text-align:right;
      white-space:nowrap;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

<div class="wrap">

  <!-- FORMULAIRE -->
  <div class="card">
    <h1>OSHER HOLIDAYS<br><span style="font-size:15px;">Devis Pessa'h 2026 – Hôtel OASIS PARK 4*</span></h1>

    <label>Nom du client</label>
    <input id="client" type="text" placeholder="Nom et prénom" />

    <div class="row">
      <div>
        <label>Adultes</label>
        <input id="adults" type="number" min="0" value="2" />
      </div>
      <div>
        <label>Âges des enfants (séparés par des virgules)</label>
        <input id="ages" type="text" placeholder="Ex : 3, 7, 11" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>3ème adulte même chambre (Qté)</label>
        <input id="thirdAdult" type="number" min="0" value="0" />
      </div>
      <div></div>
    </div>

    <div class="hint">
      Répartition automatique : bébé (&lt;3), 3–6 ans, 7–11 ans. Les âges ≥12 comptent pour la taxe de séjour.
    </div>

    <label>Période du voyage</label>
    <select id="period">
      <option value="DU 31 MARS AU 12 AVRIL 2026">DU 31 MARS AU 12 AVRIL 2026</option>
      <option value="DU 1er AVRIL AU 12 AVRIL 2026">DU 1er AVRIL AU 12 AVRIL 2026</option>
    </select>

    <label>Aéroport / Gare</label>
    <select id="airport">
      <option value="BARCELONE/GERONE">BARCELONE/GERONE</option>
    </select>

    <!-- Options transformées en champs supplémentaires -->
    <h3 style="margin-top:18px;font-size:14px;">Suppléments (quantités)</h3>
    <div class="row">
      <div>
        <label>Suites de luxe (balcon + jacuzzi)</label>
        <input id="suiteQty" type="number" min="0" value="0" />
      </div>
      <div>
        <label>Appartements + terrasse</label>
        <input id="aptQty" type="number" min="0" value="0" />
      </div>
    </div>
    <div class="row">
      <div>
        <label>Chambres communicantes</label>
        <input id="connQty" type="number" min="0" value="0" />
      </div>
      <div>
        <label>Vues piscine</label>
        <input id="poolQty" type="number" min="0" value="0" />
      </div>
    </div>

    <button class="btn" onclick="generatePDF()">Générer le devis (PDF)</button>
    <div class="hint">Le devis ci-dessous est l’aperçu réel. Le PDF sera identique.</div>
  </div>

  <!-- APERÇU DU DEVIS / ZONE PDF -->
  <div class="page" id="pdfArea">
    <h2 style="text-align:center;margin:0;">OSHER HOLIDAYS</h2>
    <h3 style="text-align:center;margin:0 0 10px 0;">Devis Pessa'h 2026 – Hôtel OASIS PARK 4*</h3>

    <table class="info-grid">
      <tr>
        <td>Date du devis</td>
        <td id="outDate"></td>
      </tr>
      <tr>
        <td>Date du voyage</td>
        <td id="outPeriod"></td>
      </tr>
      <tr>
        <td>AEROPORT / GARE</td>
        <td id="outAirport"></td>
      </tr>
    </table>

    <p style="margin-top:10px;font-size:13px;">
      <strong>Client :</strong> <span id="outClient"></span>
    </p>

    <table class="table">
      <thead>
        <tr>
          <th>Description</th>
          <th class="num">Quantité</th>
          <th class="money">Prix unitaire HT</th>
          <th class="money">Prix total HT</th>
        </tr>
      </thead>
      <tbody id="tableBody">
      </tbody>
    </table>

    <div class="footer">
      <div>
        <b>Veuillez retourner daté et signé le devis</b> pour validation à <b>info@ocherholidays.com</b><br/>
        Acompte obligatoire de 50% sur le compte suivant :<br/>
        IBAN : <b>BE75 9674 9389 3751</b> – BIC : <b>TRWIBEB1XXX</b><br/>
        Paiement par carte bancaire : <b>3,5% de frais</b>.
      </div>

      <table class="totals">
        <tr><td>Total HT</td><td id="totalHT">0,00 €</td></tr>
        <tr><td>TVA (0 %)</td><td>0,00 €</td></tr>
        <tr><td><b>Total TTC</b></td><td id="totalTTC"><b>0,00 €</b></td></tr>
      </table>
    </div>
  </div>

</div>

<script>
// PRIX FIXES
const PRICES = {
  ADULTE: 2490,
  THIRD: 2190,
  CHILD_7_11: 1390,
  CHILD_3_6: 1190,
  BEBE: 490,
  TAXE: 26,
  SUITE: 1290,
  APT: 1190,
  CONN: 1090,
  POOL: 190
};

function euro(n){
  return (Math.round(n*100)/100).toLocaleString('fr-FR',{minimumFractionDigits:2}) + ' €';
}

function parseAges(){
  const raw = document.getElementById('ages').value.trim();
  if(!raw) return [];
  return raw.split(',').map(a => Number(a.trim())).filter(a => !isNaN(a));
}

function classifyAges(ages){
  let bebe=0, c36=0, c711=0, plus12=0;
  for(const a of ages){
    if(a < 3) bebe++;
    else if(a <= 6) c36++;
    else if(a <= 11) c711++;
    else plus12++;
  }
  return {bebe, c36, c711, plus12};
}

function rebuildTable(){
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';

  const adults = Number(document.getElementById('adults').value || 0);
  const third = Number(document.getElementById('thirdAdult').value || 0);
  const ages = parseAges();
  const cls = classifyAges(ages);

  const suiteQty = Number(document.getElementById('suiteQty').value || 0);
  const aptQty   = Number(document.getElementById('aptQty').value || 0);
  const connQty  = Number(document.getElementById('connQty').value || 0);
  const poolQty  = Number(document.getElementById('poolQty').value || 0);

  const airport = document.getElementById('airport').value;
  const period  = document.getElementById('period').value;
  const client  = document.getElementById('client').value;

  document.getElementById('outAirport').innerText = airport;
  document.getElementById('outPeriod').innerText  = period;
  document.getElementById('outClient').innerText  = client;
  document.getElementById('outDate').innerText    = new Date().toLocaleDateString('fr-FR');

  let total = 0;

  function addRow(label, qty, unit){
    if(qty <= 0) return;
    const tr = document.createElement('tr');
    const lineTotal = qty * unit;
    tr.innerHTML = `
      <td class="desc">${label}</td>
      <td class="num">${qty}</td>
      <td class="money">${euro(unit)}</td>
      <td class="money">${euro(lineTotal)}</td>
    `;
    tbody.appendChild(tr);
    total += lineTotal;
  }

  addRow('ADULTE', adults, PRICES.ADULTE);
  addRow('3ème ADULTE MÊME CHAMBRE (≥12 ans)', third, PRICES.THIRD);
  addRow('ENFANT 7–11 ans', cls.c711, PRICES.CHILD_7_11);
  addRow('ENFANT 3–6 ans', cls.c36, PRICES.CHILD_3_6);
  addRow('BÉBÉ (<3 ans)', cls.bebe, PRICES.BEBE);

  const taxeQty = adults + third + cls.plus12;
  addRow('TAXE DE SÉJOUR (≥12 ans)', taxeQty, PRICES.TAXE);

  addRow('SUITE DE LUXE AVEC BALCON + JACUZZI', suiteQty, PRICES.SUITE);
  addRow('APPARTEMENT + TERRASSE', aptQty, PRICES.APT);
  addRow('CHAMBRES COMMUNICANTES', connQty, PRICES.CONN);
  addRow('VUE PISCINE', poolQty, PRICES.POOL);

  document.getElementById('totalHT').innerText  = euro(total);
  document.getElementById('totalTTC').innerText = euro(total);
}

function generatePDF(){
  rebuildTable();
  const element = document.getElementById('pdfArea');
  const client = (document.getElementById('client').value || 'CLIENT').replace(/\s+/g,'_');

  html2pdf().set({
    filename: `Devis_PESSAH_2026_OASIS_PARK_${client}.pdf`,
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  }).from(element).save();
}

window.addEventListener('load', rebuildTable);
</script>

</body>
</html>
